/*! (c) Andrea Giammarchi - ISC */
const{isArray:e}=Array,{parse:r}=JSON,t=(e,t)=>r(e.replace(/(\S+?)\s*=/g,'"$1":'),((e,r)=>"string"==typeof r?t[r[0]][r.slice(1)]:r)),s=(r,t,s)=>{for(let p=0,{length:l}=r,g=l-1;p<l;p++)t=t[r[p]]||(t[r[p]]=s&&p===g?[]:{}),e(t)&&(p!==g&&t.length||t.push({}),t=t.at(-1));return t},p=e=>{const[r,p]=((e,r,t)=>[e.replace(/(["'])(?:(?=(\\?))\2.)*?\1/g,(e=>`"s${r.push(e.slice(1,-1))-1}"`)).replace(/\d{2,}([:-]\d{2}){2}([ T:-][\dZ:-]+)?/g,(e=>`"d${t.push(new Date(e))-1}"`)).replace(/,\s*[\r\n]+/g,", ").replace(/\[\s*[\r\n]+/g,"[").replace(/[\r\n]+\s*]/g,"]"),{s:r,d:t}])(e,[],[]),l={};let g=l;for(let e of r.split(/[\r\n]+/))(e=e.trim())&&!e.startsWith("#")&&(/^(\[+)(.*?)\]+/.test(e)?g=s(RegExp.$2.trim().split("."),l,"["!==RegExp.$1):/^(\S+?)\s*=([^#]+)/.test(e)&&(g[RegExp.$1]=t(RegExp.$2.trim(),p)));return l};export{p as parse};
